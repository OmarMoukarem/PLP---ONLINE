<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PL Predictor Admin – 2025/26</title>
<style>
body { font-family:sans-serif; margin:20px; }
header { text-align:center; margin-bottom:20px; }
input { width:40px; }
button { margin-top:10px; padding:5px 10px; }
table { border-collapse: collapse; width:100%; margin-top:10px;}
th, td { border:1px solid #ccc; padding:5px; text-align:center;}
</style>
</head>
<body>
<header>
<h1>Premier League Predictor Admin – 2025/26</h1>
<div class="sub">Enter actual results → auto scoring for all players → Excel export</div>
</header>

<h2>Enter Actual Results</h2>
<div id="resultsWrap"></div>
<button id="saveResults">Save Results</button>

<h2>Admin Table</h2>
<div id="adminView"></div>
<button id="exportExcel">Export All to Excel</button>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<script>
const PLAYERS=['Omar','Robbie','Khalil','Idriss','Aboudi','Masri','Hafez','Joseph','Rizk','Dani'];
const SAMPLE_FIXTURES=[
  {id:'1', home:'Liverpool', away:'AFC Bournemouth'},
  {id:'2', home:'Aston Villa', away:'Newcastle United'},
  {id:'3', home:'Brighton & Hove Albion', away:'Fulham'},
  {id:'4', home:'Sunderland', away:'West Ham United'},
  {id:'5', home:'Tottenham Hotspur', away:'Burnley'},
  {id:'6', home:'Wolverhampton Wanderers', away:'Manchester City'},
  {id:'7', home:'Chelsea', away:'Crystal Palace'},
  {id:'8', home:'Nottingham Forest', away:'Brentford'},
  {id:'9', home:'Manchester United', away:'Arsenal'},
  {id:'10', home:'Leeds United', away:'Everton'}
];

let predictions={}, results={};

// --- Helpers ---
function parseScore(s){if(!s)return null; const p=s.trim().split(/[-:xX]/); if(p.length!==2)return null; const a=parseInt(p[0],10),b=parseInt(p[1],10); if(isNaN(a)||isNaN(b)) return null; return {hg:a,ag:b};}
function outcome(hg,ag){return hg>ag?'H':hg<ag?'A':'D';}
function goalDiff(hg,ag){return hg-ag;}
function scorePrediction(actual,pred){if(!actual||!pred?.score)return 0; const p=parseScore(pred.score); if(!p)return 0; let pts=0; const predOut=outcome(p.hg,p.ag), actualOut=outcome(actual.hg,actual.ag); if(p.hg===actual.hg && p.ag===actual.ag) pts+=3; else if(predOut===actualOut) pts+=1; else if(goalDiff(p.hg,p.ag)===goalDiff(actual.hg,actual.ag)) pts+=1; return pts;}

// --- Load Data ---
function loadData(){ 
  const savedPred=localStorage.getItem('plp_predictions'); predictions=savedPred?JSON.parse(savedPred):{};
  const savedRes=localStorage.getItem('plp_results'); results=savedRes?JSON.parse(savedRes):{};
}

// --- Render Results Input ---
function renderResults(){
  const wrap=document.getElementById('resultsWrap'); wrap.innerHTML='';
  SAMPLE_FIXTURES.forEach(f=>{
    const val=results[f.id]||{hg:'',ag:''};
    const div=document.createElement('div');
    div.innerHTML=`<b>${f.home} vs ${f.away}</b> – Home: <input type="number" data-match="${f.id}" data-side="hg" value="${val.hg}" style="width:40px"/> Away: <input type="number" data-match="${f.id}" data-side="ag" value="${val.ag}" style="width:40px"/>`;
    wrap.appendChild(div);
  });
}

// --- Save Results ---
function saveResults(){
  SAMPLE_FIXTURES.forEach(f=>{
    const hgInput=document.querySelector(`input[data-match="${f.id}"][data-side="hg"]`);
    const agInput=document.querySelector(`input[data-match="${f.id}"][data-side="ag"]`);
    results[f.id]={hg:parseInt(hgInput.value)||0,ag:parseInt(agInput.value)||0};
  });
  localStorage.setItem('plp_results',JSON.stringify(results));
  renderAdminTable();
}

// --- Render Admin Table ---
function renderAdminTable(){
  const div=document.getElementById('adminView'); if(Object.keys(predictions).length===0){div.innerHTML='No predictions yet.'; return;}
  let html='<table><tr><th>Player</th><th>Match</th><th>Home</th><th>Away</th><th>Prediction</th><th>Actual</th><th>Points</th></tr>';
  PLAYERS.forEach(p=>{
    let total=0;
    SAMPLE_FIXTURES.forEach(f=>{
      const pred=predictions[p]?.[f.id]?.score||'';
      const actual=results[f.id]?`${results[f.id].hg}-${results[f.id].ag}`:'';
      const pts=results[f.id]?scorePrediction(results[f.id],predictions[p]?.[f.id]):0;
      total+=pts;
      html+=`<tr><td>${p}</td><td>${f.id}</td><td>${f.home}</td><td>${f.away}</td><td>${pred}</td><td>${actual}</td><td>${pts}</td></tr>`;
    });
    html+=`<tr><td colspan="6" style="text-align:right"><b>Total Points for ${p}</b></td><td><b>${total}</b></td></tr>`;
  });
  html+='</table>';
  div.innerHTML=html;
}

// --- Export ---
function exportToExcel(){
  const ws_data=[['Player','Match','Home','Away','Prediction','Actual','Points']];
  PLAYERS.forEach(p=>{
    SAMPLE_FIXTURES.forEach(f=>{
      const pred=predictions[p]?.[f.id]?.score||'';
      const actual=results[f.id]?`${results[f.id].hg}-${results[f.id].ag}`:'';
      const pts=results[f.id]?scorePrediction(results[f.id],predictions[p]?.[f.id]):0;
      ws_data.push([p,f.id,f.home,f.away,pred,actual,pts]);
    });
  });
  const wb=XLSX.utils.book_new();
  const ws=XLSX.utils.aoa_to_sheet(ws_data);
  XLSX.utils.book_append_sheet(wb,ws,'Predictions');
  XLSX.writeFile(wb,'PLP_Predictions.xlsx');
}

// --- Init ---
document.addEventListener('DOMContentLoaded',()=>{
  loadData();
  renderResults();
  renderAdminTable();
  document.getElementById('saveResults').addEventListener('click',saveResults);
  document.getElementById('exportExcel').addEventListener('click',exportToExcel);
});
</script>
</body>
</html>